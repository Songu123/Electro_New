@model IEnumerable<E_commerce.Models.Product>
@{
    var selectedCategories = ViewBag.SelectedCategories as List<int> ?? new List<int>();
    var currentSort = ViewBag.SortBy as string ?? "";
}

<!-- BREADCRUMB -->
<div id="breadcrumb" class="section">
    <div class="container">
     <div class="row">
      <div class="col-md-12">
                <ul class="breadcrumb-tree">
         <li><a asp-action="Index" asp-controller="Home">Home</a></li>
         <li class="active">Store (@ViewBag.TotalProducts Results)</li>
                </ul>
     </div>
        </div>
 </div>
</div>

<!-- SECTION -->
<div class="section">
    <div class="container">
        <div class="row">
   <!-- ASIDE -->
            <div id="aside" class="col-md-3">
     <!-- Filter Form -->
        <form method="get" asp-action="Store" asp-controller="Home" id="filterForm">
       
         <!-- Category Filter -->
    <div class="aside">
    <h3 class="aside-title">Categories</h3>
    <div class="checkbox-filter">
     @foreach (var c in ViewBag.Categories)
            {
    <div class="input-checkbox">
    <input type="checkbox"
     id="cat-@c.Id"
           name="categories"
          value="@c.Id"
     checked="@selectedCategories.Contains(c.Id)"
     onchange="document.getElementById('filterForm').submit()">
       <label for="cat-@c.Id">
              <span></span>
    @c.Name
         <small>(@c.Products.Count)</small>
           </label>
 </div>
       }
     </div>
           </div>

    <!-- Price Filter -->
        <div class="aside">
        <h3 class="aside-title">Price Filter</h3>
            <div class="price-filter">
             <div class="input-number price-min">
      <label for="minPrice">Min Price:</label>
  <input id="minPrice" name="minPrice" type="number" value="@ViewBag.MinPrice" placeholder="0" min="0" step="100000">
     </div>
                  <div class="input-number price-max">
  <label for="maxPrice">Max Price:</label>
        <input id="maxPrice" name="maxPrice" type="number" value="@ViewBag.MaxPrice" placeholder="No limit" min="0" step="100000">
         </div>
          <button type="submit" class="btn btn-primary btn-block" style="margin-top: 10px;">Apply Filter</button>
      </div>
     </div>

           <!-- Hidden fields để giữ sort -->
         <input type="hidden" name="sortBy" value="@ViewBag.SortBy" />
       <input type="hidden" name="page" value="1" />
     </form>
 </div>
   <!-- /ASIDE -->

            <!-- STORE -->
        <div id="store" class="col-md-9">
    <!-- store top filter -->
    <div class="store-filter clearfix">
          <div class="store-sort">
         <label>
         Sort By:
  <select class="input-select" onchange="changeSortOrder(this.value)">
            <option value="" selected="@string.IsNullOrEmpty(currentSort)">Default</option>
        <option value="price_asc" selected="@(currentSort == "price_asc")">Price: Low to High</option>
            <option value="price_desc" selected="@(currentSort == "price_desc")">Price: High to Low</option>
      <option value="name_asc" selected="@(currentSort == "name_asc")">Name: A-Z</option>
          <option value="name_desc" selected="@(currentSort == "name_desc")">Name: Z-A</option>
       </select>
   </label>
            </div>
      </div>
       <!-- /store top filter -->

                <!-- store products -->
    <div class="row">
       @if (Model != null && Model.Any())
             {
         foreach (var item in Model)
             {
      <!-- product -->
    <div class="col-md-4 col-xs-6">
     <div class="product">
  <div class="product-img">
      <img src="~/images/products/@item.ImageUrl" alt="@item.Name" style="max-height: 250px; object-fit: contain;">
     </div>
 <div class="product-body">
       <p class="product-category">@item.Category?.Name</p>
           <h3 class="product-name"><a href="#">@item.Name</a></h3>
     <h4 class="product-price">@item.Price.ToString("N0") VNĐ</h4>
        <div class="product-rating">
    <i class="fa fa-star"></i>
    <i class="fa fa-star"></i>
        <i class="fa fa-star"></i>
          <i class="fa fa-star"></i>
          <i class="fa fa-star-o"></i>
       </div>
  <div class="product-btns">
<button class="add-to-wishlist"><i class="fa fa-heart-o"></i><span class="tooltipp">add to wishlist</span></button>
                <button class="add-to-compare"><i class="fa fa-exchange"></i><span class="tooltipp">add to compare</span></button>
     <button class="quick-view"><i class="fa fa-eye"></i><span class="tooltipp">quick view</span></button>
     </div>
    </div>
     <div class="add-to-cart">
          <button class="add-to-cart-btn"><i class="fa fa-shopping-cart"></i> add to cart</button>
       </div>
         </div>
         </div>
   <!-- /product -->
}
    }
   else
        {
      <div class="col-md-12">
         <p class="text-center">No products found.</p>
       </div>
 }
         </div>
            <!-- /store products -->

     <!-- store bottom filter (Pagination) -->
  @if (ViewBag.TotalPages > 1)
             {
          <div class="store-filter clearfix">
       <span class="store-qty">
        Showing @((ViewBag.CurrentPage - 1) * ViewBag.PageSize + 1)-@(Math.Min(ViewBag.CurrentPage * ViewBag.PageSize, ViewBag.TotalProducts)) of @ViewBag.TotalProducts products
               </span>
               <ul class="store-pagination">
      @if (ViewBag.CurrentPage > 1)
               {
           <li><a href="@Url.Action("Store", new { 
  categories = selectedCategories, 
         minPrice = ViewBag.MinPrice, 
    maxPrice = ViewBag.MaxPrice, 
     sortBy = ViewBag.SortBy, 
             page = ViewBag.CurrentPage - 1 
         })"><i class="fa fa-angle-left"></i></a></li>
    }

    @for (int i = 1; i <= ViewBag.TotalPages; i++)
       {
         <li class="@(i == ViewBag.CurrentPage ? "active" : "")">
<a href="@Url.Action("Store", new { 
   categories = selectedCategories, 
      minPrice = ViewBag.MinPrice, 
      maxPrice = ViewBag.MaxPrice, 
                 sortBy = ViewBag.SortBy, 
page = i 
        })">@i</a>
             </li>
      }

     @if (ViewBag.CurrentPage < ViewBag.TotalPages)
  {
           <li><a href="@Url.Action("Store", new { 
          categories = selectedCategories, 
       minPrice = ViewBag.MinPrice, 
   maxPrice = ViewBag.MaxPrice, 
        sortBy = ViewBag.SortBy, 
       page = ViewBag.CurrentPage + 1 
  })"><i class="fa fa-angle-right"></i></a></li>
     }
       </ul>
     </div>
            }
     <!-- /store bottom filter -->
        </div>
            <!-- /STORE -->
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function changeSortOrder(sortValue) {
  var form = document.getElementById('filterForm');
   form.querySelector('input[name="sortBy"]').value = sortValue;
            form.submit();
        }
    </script>
}
